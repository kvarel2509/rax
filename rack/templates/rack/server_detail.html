{% extends 'rack/base.html' %}
{% load tags %}

{% block title %}
	{{ object.title }} (оборудование) &mdash; rax
{% endblock %}

{% block content %}
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<form id="server_delete" method="post" action="{% url 'server_delete' pk=object.pk %}">{% csrf_token %}</form>
				<a type="button" class="btn btn-default" href="{% url 'rack_detail' object.rack.pk %}">
					&larr; Перейти к стойке
				</a>
				<a type="button" class="btn btn-default" href="{% url 'server_update' pk=object.pk %}">
					Изменить параметры оборудования
				</a>
				<button form="server_delete" type="submit" class="btn btn-danger" onclick="return confirm('Вы уверены?')">
					&times; Удалить оборудование
				</button>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<h1>{{ object.title }}</h1>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<div>
					<table class="server-description">
						<tr>
							<td>Размер (*1/3U):</td>
							<td>{{ object.length }}</td>
						</tr>
						<tr>
							<td>Портов:</td>
							<td>{{ ports|length }}</td>
						</tr>
						<tr>
							<td>Заметки:</td>
							<td>{{ object.note }}</td>
						</tr>
						<tr>
							<td>&nbsp;</td>
						</tr>
						<tr>
							<td>Тип порта по умолчанию:</td>
							<td>{{ object.base_material }}</td>
						</tr>
						<tr>
							<td>Скорость порта по умолчанию:</td>
							<td>{{ object.base_speed }}</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<hr>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<table class="ports-list">
					<tr>
						{% for i in ports %}
							<td>
								{% if i.port.material.lower == "оптика" %}
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ i.port.color }}" class="bi bi-thunderbolt" viewBox="0 0 16 16"><path d="M3.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-9Z"/><path d="M1 3a1 1 0 0 0-1 1v7.293A1 1 0 0 0 .293 12L2 13.707a1 1 0 0 0 .707.293h10.586a1 1 0 0 0 .707-.293L15.707 12a1 1 0 0 0 .293-.707V4a1 1 0 0 0-1-1H1Zm0 1h14v7.293L13.293 13H2.707L1 11.293V4Z"/></svg>
								{% else %}
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ i.port.color }}" class="bi bi-ethernet" viewBox="0 0 16 16"><path d="M14 13.5v-7a.5.5 0 0 0-.5-.5H12V4.5a.5.5 0 0 0-.5-.5h-1v-.5A.5.5 0 0 0 10 3H6a.5.5 0 0 0-.5.5V4h-1a.5.5 0 0 0-.5.5V6H2.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5ZM3.75 11h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm2 0h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm1.75.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5ZM9.75 11h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm1.75.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5Z"/><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2ZM1 2a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2Z"/></svg>
								{% endif %}
							</td>
						{% endfor %}
					</tr>
					<tr>
						{% for i in numerator_ports %}
							<td class="text-center">
							{{ i }}
							</td>
						{% endfor %}
					</tr>
				</table>

			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<hr>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<form id='del-port' method="post" action="{% url 'ports_delete' pk=object.pk %}">
					{% csrf_token %}
				</form>
				{% for i in ports %}
					<div>
						<table class="port-description">
							<tr>
								<td>
									<label for="port-{{ i.port.pk }}"></label>
									<input class='port-checkbox' form="del-port" type="checkbox" id="port-{{ i.port.pk }}" name="del-port" value="{{ i.port.pk }}">
								</td>

								<td>
									{% if i.port.material.lower == "оптика" %}
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ i.port.color }}" class="bi bi-thunderbolt" viewBox="0 0 16 16"><path d="M3.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-9Z"/><path d="M1 3a1 1 0 0 0-1 1v7.293A1 1 0 0 0 .293 12L2 13.707a1 1 0 0 0 .707.293h10.586a1 1 0 0 0 .707-.293L15.707 12a1 1 0 0 0 .293-.707V4a1 1 0 0 0-1-1H1Zm0 1h14v7.293L13.293 13H2.707L1 11.293V4Z"/></svg>
									{% else %}
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ i.port.color }}" class="bi bi-ethernet" viewBox="0 0 16 16"><path d="M14 13.5v-7a.5.5 0 0 0-.5-.5H12V4.5a.5.5 0 0 0-.5-.5h-1v-.5A.5.5 0 0 0 10 3H6a.5.5 0 0 0-.5.5V4h-1a.5.5 0 0 0-.5.5V6H2.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5ZM3.75 11h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm2 0h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm1.75.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5ZM9.75 11h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5a.25.25 0 0 1 .25-.25Zm1.75.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-1.5Z"/><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2ZM1 2a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2Z"/></svg>
									{% endif %}
								</td>
								<td>
									<strong>
										Порт {{ forloop.counter }}:
									</strong>
									Скорость:
									<strong>{{ i.port.speed }}</strong>,
									Тип:
									<strong>{{ i.port.material }}</strong>
									<small>
										<button class="btn btn-link btn-xs" onclick="showElement('form-port-update-{{ i.port.pk }}')">Изменить</button>
									</small>
								</td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								{% if i.port.note %}
									<td>{{ i.port.note }}</td>
								{% endif %}
							</tr>
							<tr>
								<td></td>
								<td></td>
								{% if i.port.connection %}
									<td>Подключен к: {{ i.port.connection }}</td>
								{% endif %}

							</tr>
							<tr>
								<td></td>
								<td></td>
								<td class='hidden' id="form-port-update-{{ i.port.pk }}">
									<form id="edit_port-{{ i.port.pk }}" method="post" action='{% url 'port_update' pk=i.port.pk %}'>
										{% csrf_token %}
										<table class="port-edit-form">{{ i.form.as_table }}</table>
										<div class="button-form">
											<button onclick="hiddenElement('form-port-update-{{ i.port.pk }}')" type="reset" class="btn btn-default">Отменить</button>
											<button form="edit_port-{{ i.port.pk }}" type="submit" class="btn btn-primary">Применить</button>
										</div>
									</form>
								</td>
							</tr>
						</table>
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<hr>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<div class="button-group">
					<button
						type="button"
						class="btn btn-success"
						onclick="showElement('create-port')"
					>
						&plus; Добавить порты
					</button>
					<button
						type="submit"
						class="btn btn-warning"
						form="del-port"
						onclick="return confirm('Вы уверены?')"
					>
						&times; Удалить выбранные порты
					</button>
					<button
						type="submit"
						class="btn btn-danger"
						form="del-port"
						onclick="if (confirm('Вы уверены?')) selectAllPorts()"
					>
						&times; Удалить все порты
					</button>
					<p>&nbsp;</p>
				</div>

				<div id="create-port" class="hidden">
					<form method="post" action='{% url 'port_create' pk=object.pk %}'>
						{% csrf_token %}
						<table class="create-ports">
							{{ create_port_form.as_table }}
						</table>
						<div class="button-form">
							<button onclick="hiddenElement('create-port')" type="reset" class="btn btn-default">Отменить</button>
							<button type="submit" class="btn btn-primary">Создать</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<style>
	.server-description {
		border-collapse: separate;
		border-spacing: 10px 2px;
	}

	.server-description td:first-child {
		font-size: medium;
		font-weight: bold;
	}

	.ports-list {
		border-collapse: separate;
		border-spacing: 5px;
	}

	#create-port {
		margin: 10px;
	}

	.create-ports {
		margin: 10px;
		padding: 10px;
		border-collapse: separate;
		border-spacing: 10px 2px;
		background: rgba(224, 243, 255, 0.35);
		border-radius: 10px;
	}

	.button-form {
		margin: 5px;
	}

	.port-description {
		border-collapse: separate;
		border-spacing: 10px 2px;
	}

	.port-edit-form {
		margin: 10px;
		padding: 10px;
		border-collapse: separate;
		border-spacing: 10px 2px;
		background: rgba(255, 224, 244, 0.35);
		border-radius: 10px;
	}
	</style>
{% endblock %}
