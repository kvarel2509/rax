{% extends 'rack/base.html' %}
{% load tags %}

{% block title %}
	"{{ object.title }}"
{% endblock %}

{% block content %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8">
				<table style="width: 100%">
					{% for i in object.size|get_range %}
						{% get_item rack i as row %}
						{% get_item numbering i as number_elem %}
						<tr style="height: 10px">

							{% if number_elem.length %}
								<td style="width: 5%" rowspan="{{ number_elem.length }}">{{ number_elem.value }}</td>
							{% endif %}

							{% if row %}
								{% if row.server %}
									<td style="background: {{ row.server.color }}" rowspan="{{ row.length }}">

										<div class="col-lg-1 text-left">
											<button type="button" class="btn btn-warning btn-xs text-left bor"
													data-toggle="modal"
													data-target="#myModal2-{{ row.server.id }}">
												Заметки
											</button>

											<div class="modal fade" id="myModal2-{{ row.server.id }}" tabindex="-1"
												 role="dialog">
												<div class="modal-dialog" role="document">
													<div class="modal-content">
														<div class="modal-header">
															<button type="button" class="close" data-dismiss="modal"
																	aria-label="Close"><span
																	aria-hidden="true">&times;</span></button>
															<h4 class="modal-title" id="myModalLabel">Заметки</h4>
														</div>
														<div class="modal-body">
															<form
																method="post"
																action="{% url 'server_note_create' row.server.id %}"
															>
																{% csrf_token %}
																{{ row.note_form.as_p }}
																<button type="reset" class="btn btn-default"
																		data-dismiss="modal">Отменить
																</button>
																<button type="submit" class="btn btn-primary">
																	Сохранить
																</button>
															</form>
														</div>
													</div>
												</div>
											</div>
										</div>

										<div class="col-lg-6 text-center">
											<strong style="padding-left: 10px; padding-right: 10px; background-color:#c9c9c9; border-radius: 6px;">{{ row.server.title }}</strong>
										</div>

										<div class="col-lg-5 text-right">
											<a
												class="btn btn-success btn-xs bor"
												href="{% url 'server_move' row.server.id 'up1' %}"
											>
												^ 1
											</a>
											<a
												class="btn btn-success btn-xs bor"
												href="{% url 'server_move' row.server.id 'up3' %}"
											>
												^ 3
											</a>
											<a
												class="btn btn-danger btn-xs bor"
												href="{% url 'server_move' row.server.id 'down1' %}"
											>
												v 1
											</a>
											<a
												class="btn btn-danger btn-xs bor"
												href="{% url 'server_move' row.server.id 'down3' %}"
											>
												v 3
											</a>
											<a
												class="btn btn-success btn-xs bor"
												href="{% url 'server_move' row.server.id 'up_max' %}"
											>
												^max
											</a>
											<a
												class="btn btn-danger btn-xs bor"
												href="{% url 'server_move' row.server.id 'down_max' %}"
											>
												v max
											</a>
											<a
												class="btn btn-danger btn-xs bor"
												href="{% url 'server_delete' row.server.id %}"
											>
												x
											</a>

										</div>
									</td>
								{% else %}
									<td rowspan="{{ row.length }}">
								{% endif %}
							{% endif %}
						</tr>
					{% endfor %}
				</table>
			</div>
			<div class="col-lg-4">
				<button type="button" class="btn btn-primary btn-lg" onclick="get_server_form()">
					Добавить оборудование
				</button>
				<div id="form_server"></div>
			</div>
		</div>
	</div>

	<style>
		table, th, td {
			border: 1px solid black;
			text-align: center;
		}
		.bor {
			border-color: #0f0f0f;
		}
	</style>

	<script>
	function get_server_form() {
		let x = document.getElementById('form_server')
		x.innerHTML = `<form method="post" action="{% url 'server_create' object.pk %}">
						{% csrf_token %}
						<table style=''>
							{{ server_creation_form.as_table }}
						</table>
						<button type="reset" class="btn btn-default" onclick="hidden_server_form()">Отменить</button>
						<button type="submit" class="btn btn-primary">Добавить</button>
					</form>`
	}
	function hidden_server_form() {
		let x = document.getElementById('form_server')
		x.innerHTML = ''
	}

	</script>

{% endblock %}