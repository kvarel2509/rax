{% extends 'rack/base.html' %}
{% load tags %}

{% block title %}
	{{ object.title }} (стойка) &mdash; rax
{% endblock %}

{% block content %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8">
				<div class="rack">
					<table>
						{% for i in object.size|get_range %}
							{% get_item space_main i as row %}
							{% get_item space_reverse i as row_reverse %}
							{% get_item numbering i as number_elem %}
							<tr>
								{% if number_elem.length %}
									<td class="numerator-row" rowspan="{{ number_elem.length }}">
										{{ number_elem.value }}
									</td>
								{% endif %}

								{% if row %}
									{% if row.server %}
										<td style="background: {{ row.server.color }}" rowspan="{{ row.length }}">
											<div class="container-fluid">
												<div class="row">
													<div class="col-lg-2">
														<button
															type="button"
															class="btn btn-primary btn-xs text-left rack-row-move"
															data-toggle="modal"
															data-target="#myModal2-{{ row.server.id }}"
														>
															заметки
														</button>

														<div class="modal fade" id="myModal2-{{ row.server.id }}" tabindex="-1" role="dialog">
															<div class="modal-dialog" role="document">
																<div class="modal-content">
																	<div class="modal-header">
																		<button
																			type="button"
																			class="close"
																			data-dismiss="modal"
																			aria-label="Close"
																		>
																			<span aria-hidden="true">&times;</span>
																		</button>
																		<h4 class="modal-title" id="myModalLabel">Заметки</h4>
																	</div>
																	<div class="modal-body">
																		<form
																			method="post"
																			action="{% url 'server_note_create' row.server.id %}"
																		>
																			{% csrf_token %}
																			{{ row.note_form.as_p }}
																			<button type="submit" class="btn btn-primary">
																				Сохранить
																			</button>
																			<button
																				type="reset"
																				class="btn btn-default"
																				data-dismiss="modal"
																			>
																				Отменить
																			</button>

																		</form>
																	</div>
																</div>
															</div>
														</div>
													</div>

													<div class="col-lg-5 server-info text-center">
														<div>
															<strong>
																<a class="server-info__name" href={% url 'server_detail' pk=row.server.pk %}>
																	{{ row.server.title }}
																</a>
															</strong>
														</div>
														{% if row.server.note %}
															<div class="server-info__note-block">
																<small class="server-info__note-block__text">
																	{{ row.server.note|truncatechars:30 }}
																</small>
															</div>
														{% endif %}
													</div>

													<div class="col-lg-5">
														<form id="server_delete-{{ row.server.id }}" method="post" action="{% url 'server_delete' pk=row.server.id %}">
															{% csrf_token %}
														</form>
														<form id="server-move-{{ row.server.id }}" method="post" action="{% url 'server_move' pk=row.server.id %}">
															{% csrf_token %}
														</form>
														<div>
															<button
																type="submit"
																class="btn btn-success btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="up1"
															>
																&uarr; 1/3
															</button>
															<button
																type="submit"
																class="btn btn-info btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="down1"
															>
																&darr; 1/3
															</button>
															<button
																type="submit"
																class="btn btn-success btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="up3"
															>
																&uarr; U
															</button>
															<button
																type="submit"
																class="btn btn-info btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="down3"
															>
																&darr; U
															</button>
															<button
																type="submit"
																class="btn btn-success btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="up_max"
															>
																&uarr; max
															</button>
															<button
																type="submit"
																class="btn btn-info btn-xs rack-row-move"
																form="server-move-{{ row.server.id }}"
																name="move_type"
																value="down_max"
															>
																&darr; max
															</button>
															<button
																type="submit"
																class="btn btn-danger btn-xs rack-row-move"
																form="server_delete-{{ row.server.id }}"
																onclick="return confirm('Вы уверены?')"
															>
																&times;
															</button>
														</div>
													</div>
												</div>
											</div>
										</td>
									{% else %}
										<td {% if not row_reverse or row_reverse.server %}class="stripes"{% endif %} rowspan="{{ row.length }}"></td>
									{% endif %}
								{% endif %}
							</tr>
						{% endfor %}
					</table>
				</div>
			</div>
			<div class="col-lg-4">
				<form id="rack-delete" method="post" action="{% url 'rack_delete' pk=object.pk %}">{% csrf_token %}</form>

				<div class="text-center">
					<div class="vertical-button">
						<div class="btn-group btn-group-justified">
							<div class="btn-group">
								<a type="button" class="btn btn-default" {% if not object.backside %}disabled="disabled"{% else %} href={% url 'rack_detail' pk=reverse_side.pk %}{% endif %}>Передняя сторона</a>
							</div>
							{% if not object.backside and not reverse_side %}
								<div class="btn-group">
									<a type="button" class="btn btn-link" href={% url 'rack_add_backside' pk=object.pk %}>Создать заднюю сторону</a>
								</div>
							{% else  %}
								<div class="btn-group">
									<a type="button" class="btn btn-default" {% if object.backside %}disabled="disabled"{% else %} href={% url 'rack_detail' pk=reverse_side.pk %}{% endif %}>Задняя сторона</a>
								</div>
							{% endif %}
						</div>
					</div>

					<div class="vertical-button">
						<button
							style="width: 100%"
							class="btn btn-success"
							title="Изменить параметры стойки"
							onclick="showElement('form-server')"
						>
							&plus; Добавить оборудование
						</button>
					</div>

					<div class="vertical-button">
						<button
							style="width: 100%"
							class="btn btn-default"
							title="Изменить параметры стойки"
							onclick="showElement('rack-update')"
						>
							Переименовать
						</button>
					</div>
					<div class="vertical-button">
						<button
							style="width: 100%"
							form="rack-delete"
							type="submit"
							class="btn btn-danger"
							title="Удалить стойку"
							onclick="return confirm('{% if not object.backside %}Вы удаляете переднюю сторону. Задняя сторона так же будет удалена.{% endif %} Вы уверены?')"
						>
							&times; Удалить стойку
						</button>
					</div>
				</div>
				<div>
					{% if object.note %}
						<div class="vertical-button"><pre>{{ object.note }}</pre></div>
					{% endif %}
				</div>
				<div id="rack-update" class="hidden">
					<form method="post" action="{% url 'rack_update' pk=object.pk %}">
						{% csrf_token %}
						<table class='add-server__table'>
							{{ rack_update_form.as_table }}
						</table>
						<button type="submit" class="btn btn-primary">Применить</button>
						<button type="reset" class="btn btn-default" onclick="hideElement('rack-update')">Отменить</button>
					</form>
				</div>
				<div id="form-server" class="hidden">
					<form method="post" action="{% url 'server_create' pk=object.pk %}">
						{% csrf_token %}
						<table class='add-server__table'>
							{{ server_creation_form.as_table }}
						</table>
						<button type="submit" class="btn btn-primary">Добавить</button>
						<button type="reset" class="btn btn-default" onclick="hideElement('form-server')">Отменить</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<style>
		div.rack tr, div.rack td {
			border: 1px solid #888888;
			text-align: center;
			height: 10px;
		}

		div.rack table {
			width: 100%;
			margin-bottom: 10px;
		}

		.server-info__name {
			padding-left: 10px;
			padding-right: 10px;
			background-color: rgba(110, 110, 110, 0.54);
			border-radius: 4px;
			font-size: 15px;
			color: #ffffff;
		}

		.server-info__name:hover {
			color: #cccccc;
		}

		.server-info__note-block {
			white-space: nowrap;
			text-overflow: ellipsis;
		}

		.server-info__note-block__text {
			padding: 2px 10px 2px 10px;
			background-color: rgba(199, 199, 199, 0.56);
			border-radius: 5px;
			font-size: 10px;
		}

		.numerator-row {
			width: 5%;
			font-size: 15px;
			font-style: oblique;
		}

		.add-server__table {
			border-collapse: separate;
			border-spacing: 10px 5px;
			margin: 10px 1px 10px 1px;
			background: rgba(213, 213, 213, 0.51);
			border-radius: 10px;
			padding: 10px;
		}

		.rack-row-move {
			border-color: #0f0f0f;
		}

		.vertical-button {
			width: 100%;
			margin: 10px;
		}

		.stripes {
			background: repeating-linear-gradient(45deg, #e0e0e0, #d9d9d9 10px, #cecece 10px, #c5c5c5 20px);
		}
	</style>
{% endblock %}
